module chechsum

var table [256]uint32

func crc32_initTable() {
    range(table)  # same as 0..255
    -> uint32
    -> repeat_apply(8, &1, ^(word) {
        if word&1 == 1 {
            (word >> 1) ^ 0xEDB88320
        } else {
            word >> 1
        }
    }) => table
}

func crc32(str) {
    ^(str.bytes() => ^(b, acc: crc=^uint32(0)) {
        table[byte(crc)^b] ^ (crc >> 8)
    })
}
